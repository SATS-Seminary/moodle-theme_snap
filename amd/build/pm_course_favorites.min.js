define(["jquery","core/ajax","core/notification","core/log","theme_snap/model_view","theme_snap/ajax_notification"],function(a,b,c,d,e,f){return function(c){d.enableAll(!0);var g=function(b,c){var d=a.Deferred();e(c,"theme_snap/course_cards");var f=function(){var b=a(c).find(".favoritetoggle");a(b).removeClass("ajaxing"),a(b).focus()};return a(c).trigger("modelUpdate",[b,f]),a(c).on("modelUpdated",function(a){d.resolve(a)}),d.promise()},h=function(b){return parseInt(a(b).find(".courseinfo-body").data("courseid"))},i=function(b,c){void 0===c&&(c=!0);var d=a(b).find(".coursefullname").html();return c&&(d=d.toLowerCase()),d},j=function(a,b){if(0===b.length)return-1;var c=[],d={};return b.each(function(){d={title:i(this),card:this},c.push(d)}),d={title:i(a),card:a},c.push(d),c.sort(function(a,b){var c=h(a.card),d=h(b.card);return a.title===b.title?c===d?0:c>d?1:-1:a.title>b.title?1:-1}),c.indexOf(d)},k=function(b,e,f,g,h){var i=a(e),k=j(b,i),l=k+1;d.debug("Moving card element into position "+l+" of list (size = "+i.length+") : "+e),l>0?l<=i.length?(d.debug("Moving card before position "+l+"  using selector "+e),a(e).eq(k).before(b)):(d.debug("Moving card after position "+i.length+" using selector "+e),a(e).eq(i.length-1).after(b)):(d.debug("Destination "+e+" empty"),g?(d.debug("prepending to "+f),a(f).prepend(b)):(d.debug("appending to "+f),a(f).append(b))),c.updateToggleCount(),"function"==typeof h&&h()},l=function(b,d){var e;a(b).data("hidden")===!0?(e="#fixy-hidden-courses",a(".header-hidden-courses").addClass("state-visible"),a("#fixy-hidden-courses").is(":visible")||c.toggleHidden(!1)):e="#fixy-visible-courses",k(b,e+" .courseinfo:not(.favorited)",e,!1,d)},m=function(c){if(!a(c).hasClass("ajaxing")){a(c).addClass("ajaxing");var d="true"===a(c).attr("aria-pressed")?0:1,e=a(a(c).parents(".courseinfo")[0]),h=a(e).data("shortname"),i=function(i){return b.call([{methodname:"theme_snap_course_card",args:{courseshortname:h,favorited:d},fail:function(b){a(c).removeClass("ajaxing"),f.ifErrorShowBestMsg(b)}}],!0,!0)[0].then(function(a){return g(a,e)}).then(function(){M.util.js_complete(i)})};if(1===d){var j="favourite_"+(new Date).getTime().toString(16)+Math.floor(1e3*Math.random());M.util.js_pending(j),k(e,"#fixy-visible-courses .courseinfo.favorited","#fixy-visible-courses",!0,function(){i(j)})}else{var j="unfavourite_"+(new Date).getTime().toString(16)+Math.floor(1e3*Math.random());M.util.js_pending(j),l(e,function(){i(j)})}}};a("#fixy-my-courses").on("click",".favoritetoggle",function(a){a.preventDefault(),a.stopPropagation(),m(this)})}});